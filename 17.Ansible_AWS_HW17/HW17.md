## HW17

1. Создать ес2 t3.micro с помощью ansible playbook.
2. Запустить там докер контейнер.
3. Удалить этот инстанс.
Использовать один playbook.

```bash

(myenv) ivcpaladin@ivcpaladin:~/01.HW_automation/ansible-palybook$ ansible-playbook playbook.yml -vvv
ansible-playbook [core 2.16.3]
  config file = /etc/ansible/ansible.cfg
  configured module search path = ['/home/ivcpaladin/.ansible/plugins/modules', '/usr/share/ansible/plugins/modules']
  ansible python module location = /usr/lib/python3/dist-packages/ansible
  ansible collection location = /home/ivcpaladin/.ansible/collections:/usr/share/ansible/collections
  executable location = /usr/bin/ansible-playbook
  python version = 3.12.3 (main, Nov  6 2024, 18:32:19) [GCC 13.2.0] (/usr/bin/python3)
  jinja version = 3.1.2
  libyaml = True
Using /etc/ansible/ansible.cfg as config file
host_list declined parsing /etc/ansible/hosts as it did not pass its verify_file() method
script declined parsing /etc/ansible/hosts as it did not pass its verify_file() method
auto declined parsing /etc/ansible/hosts as it did not pass its verify_file() method
Parsed /etc/ansible/hosts inventory source with ini plugin
Skipping callback 'default', as we already have a stdout callback.
Skipping callback 'minimal', as we already have a stdout callback.
Skipping callback 'oneline', as we already have a stdout callback.

PLAYBOOK: playbook.yml ****************************************************************************************************************************************
1 plays in playbook.yml

PLAY [Manage EC2 instance and Docker] *************************************************************************************************************************

TASK [Launch EC2 instance] ************************************************************************************************************************************
task path: /home/ivcpaladin/01.HW_automation/ansible-palybook/playbook.yml:18
<127.0.0.1> ESTABLISH LOCAL CONNECTION FOR USER: ivcpaladin
<127.0.0.1> EXEC /bin/sh -c 'echo ~ivcpaladin && sleep 0'
<127.0.0.1> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /home/ivcpaladin/.ansible/tmp `"&& mkdir "` echo /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066196.2626941-3484831-179239784584873 `" && echo ansible-tmp-1736066196.2626941-3484831-179239784584873="` echo /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066196.2626941-3484831-179239784584873 `" ) && sleep 0'
Using module file /usr/lib/python3/dist-packages/ansible_collections/amazon/aws/plugins/modules/ec2_instance.py
<127.0.0.1> PUT /home/ivcpaladin/.ansible/tmp/ansible-local-3484815gmiut4o6/tmp2ckss7hn TO /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066196.2626941-3484831-179239784584873/AnsiballZ_ec2_instance.py
<127.0.0.1> EXEC /bin/sh -c 'chmod u+x /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066196.2626941-3484831-179239784584873/ /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066196.2626941-3484831-179239784584873/AnsiballZ_ec2_instance.py && sleep 0'
<127.0.0.1> EXEC /bin/sh -c '/usr/bin/python3 /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066196.2626941-3484831-179239784584873/AnsiballZ_ec2_instance.py && sleep 0'
<127.0.0.1> EXEC /bin/sh -c 'rm -f -r /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066196.2626941-3484831-179239784584873/ > /dev/null 2>&1 && sleep 0'
changed: [localhost] => {
    "changed": true,
    "instance_ids": [
        "i-03cfbcaca47b98126"
    ],
    "instances": [
        {
            "ami_launch_index": 0,
            "architecture": "x86_64",
            "block_device_mappings": [
                {
                    "device_name": "/dev/sda1",
                    "ebs": {
                        "attach_time": "2025-01-05T08:36:41+00:00",
                        "delete_on_termination": true,
                        "status": "attached",
                        "volume_id": "vol-05f973ad985ad5661"
                    }
                }
            ],
            "boot_mode": "uefi-preferred",
            "capacity_reservation_specification": {
                "capacity_reservation_preference": "open"
            },
            "client_token": "02e281a46f4a4876a06a2df6ef8adef0",
            "cpu_options": {
                "core_count": 1,
                "threads_per_core": 2
            },
            "current_instance_boot_mode": "uefi",
            "ebs_optimized": false,
            "ena_support": true,
            "enclave_options": {
                "enabled": false
            },
            "hibernation_options": {
                "configured": false
            },
            "hypervisor": "xen",
            "image_id": "ami-0e2c8caa4b6378d8c",
            "instance_id": "i-03cfbcaca47b98126",
            "instance_type": "t3.micro",
            "key_name": "devops",
            "launch_time": "2025-01-05T08:36:40+00:00",
            "maintenance_options": {
                "auto_recovery": "default"
            },
            "metadata_options": {
                "http_endpoint": "enabled",
                "http_protocol_ipv6": "disabled",
                "http_put_response_hop_limit": 2,
                "http_tokens": "required",
                "instance_metadata_tags": "disabled",
                "state": "applied"
            },
            "monitoring": {
                "state": "disabled"
            },
            "network_interfaces": [
                {
                    "association": {
                        "ip_owner_id": "amazon",
                        "public_dns_name": "ec2-34-235-165-167.compute-1.amazonaws.com",
                        "public_ip": "34.235.165.167"
                    },
                    "attachment": {
                        "attach_time": "2025-01-05T08:36:40+00:00",
                        "attachment_id": "eni-attach-099b9ebdf819dc28f",
                        "delete_on_termination": true,
                        "device_index": 0,
                        "network_card_index": 0,
                        "status": "attached"
                    },
                    "description": "",
                    "groups": [
                        {
                            "group_id": "sg-0827dcdc425d4a0c9",
                            "group_name": "default"
                        }
                    ],
                    "interface_type": "interface",
                    "ipv6_addresses": [],
                    "mac_address": "0a:ff:fd:7d:39:43",
                    "network_interface_id": "eni-0b7732149b44a2bac",
                    "owner_id": "443370672158",
                    "private_dns_name": "ip-172-31-25-114.ec2.internal",
                    "private_ip_address": "172.31.25.114",
                    "private_ip_addresses": [
                        {
                            "association": {
                                "ip_owner_id": "amazon",
                                "public_dns_name": "ec2-34-235-165-167.compute-1.amazonaws.com",
                                "public_ip": "34.235.165.167"
                            },
                            "primary": true,
                            "private_dns_name": "ip-172-31-25-114.ec2.internal",
                            "private_ip_address": "172.31.25.114"
                        }
                    ],
                    "source_dest_check": true,
                    "status": "in-use",
                    "subnet_id": "subnet-0f92fec37d881571a",
                    "vpc_id": "vpc-0ba16865d0655a924"
                }
            ],
            "placement": {
                "availability_zone": "us-east-1a",
                "group_name": "",
                "tenancy": "default"
            },
            "platform_details": "Linux/UNIX",
            "private_dns_name": "ip-172-31-25-114.ec2.internal",
            "private_dns_name_options": {
                "enable_resource_name_dns_a_record": false,
                "enable_resource_name_dns_aaaa_record": false,
                "hostname_type": "ip-name"
            },
            "private_ip_address": "172.31.25.114",
            "product_codes": [],
            "public_dns_name": "ec2-34-235-165-167.compute-1.amazonaws.com",
            "public_ip_address": "34.235.165.167",
            "root_device_name": "/dev/sda1",
            "root_device_type": "ebs",
            "security_groups": [
                {
                    "group_id": "sg-0827dcdc425d4a0c9",
                    "group_name": "default"
                }
            ],
            "source_dest_check": true,
            "state": {
                "code": 16,
                "name": "running"
            },
            "state_transition_reason": "",
            "subnet_id": "subnet-0f92fec37d881571a",
            "tags": {
                "Name": "Ansible-Baksushyn"
            },
            "usage_operation": "RunInstances",
            "usage_operation_update_time": "2025-01-05T08:36:40+00:00",
            "virtualization_type": "hvm",
            "vpc_id": "vpc-0ba16865d0655a924"
        }
    ],
    "invocation": {
        "module_args": {
            "aap_callback": null,
            "access_key": null,
            "additional_info": null,
            "availability_zone": null,
            "aws_ca_bundle": null,
            "aws_config": null,
            "count": 1,
            "cpu_credit_specification": null,
            "cpu_options": null,
            "debug_botocore_endpoint_logs": false,
            "detailed_monitoring": null,
            "ebs_optimized": null,
            "endpoint_url": null,
            "exact_count": null,
            "filters": null,
            "hibernation_options": false,
            "iam_instance_profile": null,
            "image": null,
            "image_id": "ami-0e2c8caa4b6378d8c",
            "instance_ids": [],
            "instance_initiated_shutdown_behavior": null,
            "instance_type": "t3.micro",
            "key_name": "devops",
            "launch_template": null,
            "license_specifications": null,
            "metadata_options": null,
            "name": null,
            "network": null,
            "placement": null,
            "placement_group": null,
            "profile": null,
            "purge_tags": true,
            "region": "us-east-1",
            "secret_key": null,
            "security_group": null,
            "security_groups": [],
            "session_token": null,
            "state": "present",
            "tags": {
                "Name": "Ansible-Baksushyn"
            },
            "tenancy": null,
            "termination_protection": null,
            "user_data": null,
            "validate_certs": true,
            "volumes": null,
            "vpc_subnet_id": null,
            "wait": true,
            "wait_timeout": 600
        }
    },
    "spec": {
        "BlockDeviceMappings": [],
        "ClientToken": "02e281a46f4a4876a06a2df6ef8adef0",
        "ImageId": "ami-0e2c8caa4b6378d8c",
        "InstanceType": "t3.micro",
        "KeyName": "devops",
        "MaxCount": 1,
        "MinCount": 1,
        "NetworkInterfaces": [
            {
                "DeviceIndex": 0,
                "SubnetId": "subnet-0f92fec37d881571a"
            }
        ],
        "TagSpecifications": [
            {
                "ResourceType": "volume",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "Ansible-Baksushyn"
                    }
                ]
            },
            {
                "ResourceType": "instance",
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "Ansible-Baksushyn"
                    }
                ]
            }
        ]
    }
}

TASK [Debug EC2 instance details] *****************************************************************************************************************************
task path: /home/ivcpaladin/01.HW_automation/ansible-palybook/playbook.yml:30
ok: [localhost] => {
    "ec2_instance": {
        "changed": true,
        "failed": false,
        "instance_ids": [
            "i-03cfbcaca47b98126"
        ],
        "instances": [
            {
                "ami_launch_index": 0,
                "architecture": "x86_64",
                "block_device_mappings": [
                    {
                        "device_name": "/dev/sda1",
                        "ebs": {
                            "attach_time": "2025-01-05T08:36:41+00:00",
                            "delete_on_termination": true,
                            "status": "attached",
                            "volume_id": "vol-05f973ad985ad5661"
                        }
                    }
                ],
                "boot_mode": "uefi-preferred",
                "capacity_reservation_specification": {
                    "capacity_reservation_preference": "open"
                },
                "client_token": "02e281a46f4a4876a06a2df6ef8adef0",
                "cpu_options": {
                    "core_count": 1,
                    "threads_per_core": 2
                },
                "current_instance_boot_mode": "uefi",
                "ebs_optimized": false,
                "ena_support": true,
                "enclave_options": {
                    "enabled": false
                },
                "hibernation_options": {
                    "configured": false
                },
                "hypervisor": "xen",
                "image_id": "ami-0e2c8caa4b6378d8c",
                "instance_id": "i-03cfbcaca47b98126",
                "instance_type": "t3.micro",
                "key_name": "devops",
                "launch_time": "2025-01-05T08:36:40+00:00",
                "maintenance_options": {
                    "auto_recovery": "default"
                },
                "metadata_options": {
                    "http_endpoint": "enabled",
                    "http_protocol_ipv6": "disabled",
                    "http_put_response_hop_limit": 2,
                    "http_tokens": "required",
                    "instance_metadata_tags": "disabled",
                    "state": "applied"
                },
                "monitoring": {
                    "state": "disabled"
                },
                "network_interfaces": [
                    {
                        "association": {
                            "ip_owner_id": "amazon",
                            "public_dns_name": "ec2-34-235-165-167.compute-1.amazonaws.com",
                            "public_ip": "34.235.165.167"
                        },
                        "attachment": {
                            "attach_time": "2025-01-05T08:36:40+00:00",
                            "attachment_id": "eni-attach-099b9ebdf819dc28f",
                            "delete_on_termination": true,
                            "device_index": 0,
                            "network_card_index": 0,
                            "status": "attached"
                        },
                        "description": "",
                        "groups": [
                            {
                                "group_id": "sg-0827dcdc425d4a0c9",
                                "group_name": "default"
                            }
                        ],
                        "interface_type": "interface",
                        "ipv6_addresses": [],
                        "mac_address": "0a:ff:fd:7d:39:43",
                        "network_interface_id": "eni-0b7732149b44a2bac",
                        "owner_id": "443370672158",
                        "private_dns_name": "ip-172-31-25-114.ec2.internal",
                        "private_ip_address": "172.31.25.114",
                        "private_ip_addresses": [
                            {
                                "association": {
                                    "ip_owner_id": "amazon",
                                    "public_dns_name": "ec2-34-235-165-167.compute-1.amazonaws.com",
                                    "public_ip": "34.235.165.167"
                                },
                                "primary": true,
                                "private_dns_name": "ip-172-31-25-114.ec2.internal",
                                "private_ip_address": "172.31.25.114"
                            }
                        ],
                        "source_dest_check": true,
                        "status": "in-use",
                        "subnet_id": "subnet-0f92fec37d881571a",
                        "vpc_id": "vpc-0ba16865d0655a924"
                    }
                ],
                "placement": {
                    "availability_zone": "us-east-1a",
                    "group_name": "",
                    "tenancy": "default"
                },
                "platform_details": "Linux/UNIX",
                "private_dns_name": "ip-172-31-25-114.ec2.internal",
                "private_dns_name_options": {
                    "enable_resource_name_dns_a_record": false,
                    "enable_resource_name_dns_aaaa_record": false,
                    "hostname_type": "ip-name"
                },
                "private_ip_address": "172.31.25.114",
                "product_codes": [],
                "public_dns_name": "ec2-34-235-165-167.compute-1.amazonaws.com",
                "public_ip_address": "34.235.165.167",
                "root_device_name": "/dev/sda1",
                "root_device_type": "ebs",
                "security_groups": [
                    {
                        "group_id": "sg-0827dcdc425d4a0c9",
                        "group_name": "default"
                    }
                ],
                "source_dest_check": true,
                "state": {
                    "code": 16,
                    "name": "running"
                },
                "state_transition_reason": "",
                "subnet_id": "subnet-0f92fec37d881571a",
                "tags": {
                    "Name": "Ansible-Baksushyn"
                },
                "usage_operation": "RunInstances",
                "usage_operation_update_time": "2025-01-05T08:36:40+00:00",
                "virtualization_type": "hvm",
                "vpc_id": "vpc-0ba16865d0655a924"
            }
        ],
        "spec": {
            "BlockDeviceMappings": [],
            "ClientToken": "02e281a46f4a4876a06a2df6ef8adef0",
            "ImageId": "ami-0e2c8caa4b6378d8c",
            "InstanceType": "t3.micro",
            "KeyName": "devops",
            "MaxCount": 1,
            "MinCount": 1,
            "NetworkInterfaces": [
                {
                    "DeviceIndex": 0,
                    "SubnetId": "subnet-0f92fec37d881571a"
                }
            ],
            "TagSpecifications": [
                {
                    "ResourceType": "volume",
                    "Tags": [
                        {
                            "Key": "Name",
                            "Value": "Ansible-Baksushyn"
                        }
                    ]
                },
                {
                    "ResourceType": "instance",
                    "Tags": [
                        {
                            "Key": "Name",
                            "Value": "Ansible-Baksushyn"
                        }
                    ]
                }
            ]
        }
    }
}

TASK [Save instance details as facts] *************************************************************************************************************************
task path: /home/ivcpaladin/01.HW_automation/ansible-palybook/playbook.yml:34
ok: [localhost] => {
    "ansible_facts": {
        "instance_id": "i-03cfbcaca47b98126",
        "instance_ip": "34.235.165.167"
    },
    "changed": false
}

TASK [Wait for SSH to become available] ***********************************************************************************************************************
task path: /home/ivcpaladin/01.HW_automation/ansible-palybook/playbook.yml:40
<localhost> ESTABLISH LOCAL CONNECTION FOR USER: ivcpaladin
<localhost> EXEC /bin/sh -c 'echo ~ivcpaladin && sleep 0'
<localhost> EXEC /bin/sh -c '( umask 77 && mkdir -p "` echo /home/ivcpaladin/.ansible/tmp `"&& mkdir "` echo /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066217.910069-3485114-183156656628977 `" && echo ansible-tmp-1736066217.910069-3485114-183156656628977="` echo /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066217.910069-3485114-183156656628977 `" ) && sleep 0'
Using module file /usr/lib/python3/dist-packages/ansible/modules/wait_for.py
<localhost> PUT /home/ivcpaladin/.ansible/tmp/ansible-local-3484815gmiut4o6/tmpql5n3xkn TO /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066217.910069-3485114-183156656628977/AnsiballZ_wait_for.py
<localhost> EXEC /bin/sh -c 'chmod u+x /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066217.910069-3485114-183156656628977/ /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066217.910069-3485114-183156656628977/AnsiballZ_wait_for.py && sleep 0'
<localhost> EXEC /bin/sh -c '/usr/bin/python3 /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066217.910069-3485114-183156656628977/AnsiballZ_wait_for.py && sleep 0'
<localhost> EXEC /bin/sh -c 'rm -f -r /home/ivcpaladin/.ansible/tmp/ansible-tmp-1736066217.910069-3485114-183156656628977/ > /dev/null 2>&1 && sleep 0'
ok: [localhost] => {
    "changed": false,
    "elapsed": 3,
    "invocation": {
        "module_args": {
            "active_connection_states": [
                "ESTABLISHED",
                "FIN_WAIT1",
                "FIN_WAIT2",
                "SYN_RECV",
                "SYN_SENT",
                "TIME_WAIT"
            ],
            "connect_timeout": 5,
            "delay": 0,
            "exclude_hosts": null,
            "host": "34.235.165.167",
            "msg": null,
            "path": null,
            "port": 22,
            "search_regex": null,
            "sleep": 1,
            "state": "started",
            "timeout": 300
        }
    },
    "match_groupdict": {},
    "match_groups": [],
    "path": null,
    "port": 22,
    "search_regex": null,
    "state": "started"
}

TASK [Add instance to inventory] ******************************************************************************************************************************
task path: /home/ivcpaladin/01.HW_automation/ansible-palybook/playbook.yml:47
creating host via 'add_host': hostname=ec2_instance
changed: [localhost] => {
    "add_host": {
        "groups": [],
        "host_name": "ec2_instance",
        "host_vars": {
            "ansible_connection": "ssh",
            "ansible_host": "34.235.165.167",
            "ansible_ssh_private_key_file": "/home/ivcpaladin/.ssh/devops.pem",
            "ansible_user": "ubuntu"
        }
    },
    "changed": true
}

PLAY RECAP ****************************************************************************************************************************************************
localhost                  : ok=5    changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0

(myenv) ivcpaladin@ivcpaladin:~/01.HW_automation/ansible-palybook$

(myenv) ivcpaladin@ivcpaladin:~/.ssh$ ssh -i ~/.ssh/devops.pem ubuntu@34.235.165.167
The authenticity of host '34.235.165.167 (34.235.165.167)' can't be established.
ED25519 key fingerprint is SHA256:yhzYovHaC5RblgYxrf7GeTV9nqEY5jLGYm+79wD5lfY.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '34.235.165.167' (ED25519) to the list of known hosts.
Welcome to Ubuntu 24.04.1 LTS (GNU/Linux 6.8.0-1018-aws x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Sun Jan  5 08:41:55 UTC 2025

  System load:  0.08              Temperature:           -273.1 C
  Usage of /:   24.7% of 6.71GB   Processes:             114
  Memory usage: 24%               Users logged in:       0
  Swap usage:   0%                IPv4 address for ens5: 172.31.25.114

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

Enable ESM Apps to receive additional future security updates.
See https://ubuntu.com/esm or run: sudo pro status


The list of available updates is more than a week old.
To check for new updates run: sudo apt update


The programs included with the Ubuntu system are free software;
the exact distribution terms for each program are described in the
individual files in /usr/share/doc/*/copyright.

Ubuntu comes with ABSOLUTELY NO WARRANTY, to the extent permitted by
applicable law.

To run a command as administrator (user "root"), use "sudo <command>".
See "man sudo_root" for details.

ubuntu@ip-172-31-25-114:~$ sudo apt update
Hit:1 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble InRelease
Get:2 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates InRelease [126 kB]
Get:3 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports InRelease [126 kB]
Get:4 http://security.ubuntu.com/ubuntu noble-security InRelease [126 kB]
Get:5 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/universe amd64 Packages [15.0 MB]
Get:6 http://security.ubuntu.com/ubuntu noble-security/main amd64 Packages [572 kB]
Get:7 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/universe Translation-en [5982 kB]
Get:8 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/universe amd64 Components [3871 kB]
Get:9 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/universe amd64 c-n-f Metadata [301 kB]
Get:10 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/multiverse amd64 Packages [269 kB]
Get:11 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/multiverse Translation-en [118 kB]
Get:12 http://security.ubuntu.com/ubuntu noble-security/main Translation-en [111 kB]
Get:13 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/multiverse amd64 Components [35.0 kB]
Get:14 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/multiverse amd64 c-n-f Metadata [8328 B]
Get:15 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/main amd64 Packages [764 kB]
Get:16 http://security.ubuntu.com/ubuntu noble-security/main amd64 Components [7236 B]
Get:17 http://security.ubuntu.com/ubuntu noble-security/universe amd64 Packages [795 kB]
Get:18 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/main Translation-en [173 kB]
Get:19 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/main amd64 Components [151 kB]
Get:20 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/universe amd64 Packages [967 kB]
Get:21 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/universe Translation-en [238 kB]
Get:22 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/universe amd64 Components [309 kB]
Get:23 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/universe amd64 c-n-f Metadata [19.9 kB]
Get:24 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/restricted amd64 Packages [574 kB]
Get:25 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/restricted Translation-en [111 kB]
Get:26 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/restricted amd64 Components [212 B]
Get:27 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 Packages [16.0 kB]
Get:28 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/multiverse Translation-en [3844 B]
Get:29 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 Components [940 B]
Get:30 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/multiverse amd64 c-n-f Metadata [552 B]
Get:31 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports/main amd64 Components [208 B]
Get:32 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports/main amd64 c-n-f Metadata [112 B]
Get:33 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports/universe amd64 Packages [10.7 kB]
Get:34 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports/universe Translation-en [10.8 kB]
Get:35 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports/universe amd64 Components [11.7 kB]
Get:36 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports/universe amd64 c-n-f Metadata [1104 B]
Get:37 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports/restricted amd64 Components [216 B]
Get:38 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports/restricted amd64 c-n-f Metadata [116 B]
Get:39 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports/multiverse amd64 Components [212 B]
Get:40 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-backports/multiverse amd64 c-n-f Metadata [116 B]
Get:41 http://security.ubuntu.com/ubuntu noble-security/universe Translation-en [169 kB]
Get:42 http://security.ubuntu.com/ubuntu noble-security/universe amd64 Components [52.0 kB]
Get:43 http://security.ubuntu.com/ubuntu noble-security/universe amd64 c-n-f Metadata [13.5 kB]
Get:44 http://security.ubuntu.com/ubuntu noble-security/restricted amd64 Packages [560 kB]
Get:45 http://security.ubuntu.com/ubuntu noble-security/restricted Translation-en [108 kB]
Get:46 http://security.ubuntu.com/ubuntu noble-security/restricted amd64 Components [212 B]
Get:47 http://security.ubuntu.com/ubuntu noble-security/multiverse amd64 Packages [12.2 kB]
Get:48 http://security.ubuntu.com/ubuntu noble-security/multiverse Translation-en [2940 B]
Get:49 http://security.ubuntu.com/ubuntu noble-security/multiverse amd64 Components [208 B]
Get:50 http://security.ubuntu.com/ubuntu noble-security/multiverse amd64 c-n-f Metadata [356 B]
Fetched 31.8 MB in 6s (5043 kB/s)
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
58 packages can be upgraded. Run 'apt list --upgradable' to see them.
ubuntu@ip-172-31-25-114:~$ sudo apt install -y docker.io
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  bridge-utils containerd dns-root-data dnsmasq-base pigz runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-buildx docker-compose-v2 docker-doc rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dns-root-data dnsmasq-base docker.io pigz runc ubuntu-fan
0 upgraded, 8 newly installed, 0 to remove and 58 not upgraded.
Need to get 80.1 MB of archives.
After this operation, 304 MB of additional disk space will be used.
Get:1 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/universe amd64 pigz amd64 2.8-1 [65.6 kB]
Get:2 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/main amd64 bridge-utils amd64 1.7.1-1ubuntu2 [33.9 kB]
Get:3 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/main amd64 runc amd64 1.1.12-0ubuntu3.1 [8599 kB]
Get:4 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/main amd64 containerd amd64 1.7.19+really1.7.12-0ubuntu4.2 [38.6 MB]
Get:5 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/main amd64 dns-root-data all 2023112702~willsync1 [4450 B]
Get:6 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/main amd64 dnsmasq-base amd64 2.90-2build2 [375 kB]
Get:7 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble-updates/universe amd64 docker.io amd64 26.1.3-0ubuntu1~24.04.1 [32.4 MB]
Get:8 http://us-east-1.ec2.archive.ubuntu.com/ubuntu noble/universe amd64 ubuntu-fan all 0.12.16 [35.2 kB]
Fetched 80.1 MB in 2s (42.7 MB/s)
Preconfiguring packages ...
Selecting previously unselected package pigz.
(Reading database ... 70601 files and directories currently installed.)
Preparing to unpack .../0-pigz_2.8-1_amd64.deb ...
Unpacking pigz (2.8-1) ...
Selecting previously unselected package bridge-utils.
Preparing to unpack .../1-bridge-utils_1.7.1-1ubuntu2_amd64.deb ...
Unpacking bridge-utils (1.7.1-1ubuntu2) ...
Selecting previously unselected package runc.
Preparing to unpack .../2-runc_1.1.12-0ubuntu3.1_amd64.deb ...
Unpacking runc (1.1.12-0ubuntu3.1) ...
Selecting previously unselected package containerd.
Preparing to unpack .../3-containerd_1.7.19+really1.7.12-0ubuntu4.2_amd64.deb ...
Unpacking containerd (1.7.19+really1.7.12-0ubuntu4.2) ...
Selecting previously unselected package dns-root-data.
Preparing to unpack .../4-dns-root-data_2023112702~willsync1_all.deb ...
Unpacking dns-root-data (2023112702~willsync1) ...
Selecting previously unselected package dnsmasq-base.
Preparing to unpack .../5-dnsmasq-base_2.90-2build2_amd64.deb ...
Unpacking dnsmasq-base (2.90-2build2) ...
Selecting previously unselected package docker.io.
Preparing to unpack .../6-docker.io_26.1.3-0ubuntu1~24.04.1_amd64.deb ...
Unpacking docker.io (26.1.3-0ubuntu1~24.04.1) ...
Selecting previously unselected package ubuntu-fan.
Preparing to unpack .../7-ubuntu-fan_0.12.16_all.deb ...
Unpacking ubuntu-fan (0.12.16) ...
Setting up dnsmasq-base (2.90-2build2) ...
Setting up runc (1.1.12-0ubuntu3.1) ...
Setting up dns-root-data (2023112702~willsync1) ...
Setting up bridge-utils (1.7.1-1ubuntu2) ...
Setting up pigz (2.8-1) ...
Setting up containerd (1.7.19+really1.7.12-0ubuntu4.2) ...
Created symlink /etc/systemd/system/multi-user.target.wants/containerd.service → /usr/lib/systemd/system/containerd.service.
Setting up ubuntu-fan (0.12.16) ...
Created symlink /etc/systemd/system/multi-user.target.wants/ubuntu-fan.service → /usr/lib/systemd/system/ubuntu-fan.service.
Setting up docker.io (26.1.3-0ubuntu1~24.04.1) ...
info: Selecting GID from range 100 to 999 ...
info: Adding group `docker' (GID 113) ...
Created symlink /etc/systemd/system/multi-user.target.wants/docker.service → /usr/lib/systemd/system/docker.service.
Created symlink /etc/systemd/system/sockets.target.wants/docker.socket → /usr/lib/systemd/system/docker.socket.
Processing triggers for dbus (1.14.10-4ubuntu4.1) ...
Processing triggers for man-db (2.12.0-4build2) ...
Scanning processes...
Scanning linux images...

Running kernel seems to be up-to-date.

No services need to be restarted.

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.
ubuntu@ip-172-31-25-114:~$ sudo systemctl start docker
ubuntu@ip-172-31-25-114:~$ sudo systemctl enable docker
ubuntu@ip-172-31-25-114:~$ sudo systemctl docker status
Unknown command verb 'docker', did you mean 'cancel'?
ubuntu@ip-172-31-25-114:~$ sudo systemctl status docker
● docker.service - Docker Application Container Engine
     Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; preset: enabled)
     Active: active (running) since Sun 2025-01-05 08:42:45 UTC; 1min 6s ago
TriggeredBy: ● docker.socket
       Docs: https://docs.docker.com
   Main PID: 1944 (dockerd)
      Tasks: 9
     Memory: 36.0M (peak: 36.9M)
        CPU: 413ms
     CGroup: /system.slice/docker.service
             └─1944 /usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock

Jan 05 08:42:44 ip-172-31-25-114 systemd[1]: Starting docker.service - Docker Application Container Engine...
Jan 05 08:42:44 ip-172-31-25-114 dockerd[1944]: time="2025-01-05T08:42:44.663516022Z" level=info msg="Starting up"
Jan 05 08:42:44 ip-172-31-25-114 dockerd[1944]: time="2025-01-05T08:42:44.666349981Z" level=info msg="detected 127.0.0.53 nameserver, assuming systemd-resolve>
Jan 05 08:42:44 ip-172-31-25-114 dockerd[1944]: time="2025-01-05T08:42:44.833765694Z" level=info msg="Loading containers: start."
Jan 05 08:42:45 ip-172-31-25-114 dockerd[1944]: time="2025-01-05T08:42:45.338917350Z" level=info msg="Loading containers: done."
Jan 05 08:42:45 ip-172-31-25-114 dockerd[1944]: time="2025-01-05T08:42:45.401495026Z" level=info msg="Docker daemon" commit="26.1.3-0ubuntu1~24.04.1" containe>
Jan 05 08:42:45 ip-172-31-25-114 dockerd[1944]: time="2025-01-05T08:42:45.401755235Z" level=info msg="Daemon has completed initialization"
Jan 05 08:42:45 ip-172-31-25-114 dockerd[1944]: time="2025-01-05T08:42:45.463103526Z" level=info msg="API listen on /run/docker.sock"
Jan 05 08:42:45 ip-172-31-25-114 systemd[1]: Started docker.service - Docker Application Container Engine.
lines 1-21/21 (END)
[1]+  Stopped                 sudo systemctl status docker
ubuntu@ip-172-31-25-114:~$ sudo docker run -d -p 80:80 --name webserver nginx
Unable to find image 'nginx:latest' locally
latest: Pulling from library/nginx
fd674058ff8f: Pull complete
566e42bcee1c: Pull complete
2b99b9c5d9e5: Pull complete
bd98674871f5: Pull complete
1e109dd2a0d7: Pull complete
da8cc133ff82: Pull complete
c44f27309ea1: Pull complete
Digest: sha256:42e917aaa1b5bb40dd0f6f7f4f857490ac7747d7ef73b391c774a41a8b994f15
Status: Downloaded newer image for nginx:latest
0523766808c1509e3ea85aca06376c59162dc8da948f37887018c24ee90937eb
ubuntu@ip-172-31-25-114:~$ sudo docker ps
CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS         PORTS                               NAMES
0523766808c1   nginx     "/docker-entrypoint.…"   11 seconds ago   Up 9 seconds   0.0.0.0:80->80/tcp, :::80->80/tcp   webserver
ubuntu@ip-172-31-25-114:~$ curl -I http://localhost:80
HTTP/1.1 200 OK
Server: nginx/1.27.3
Date: Sun, 05 Jan 2025 08:45:18 GMT
Content-Type: text/html
Content-Length: 615
Last-Modified: Tue, 26 Nov 2024 15:55:00 GMT
Connection: keep-alive
ETag: "6745ef54-267"
Accept-Ranges: bytes

ubuntu@ip-172-31-25-114:~$

ubuntu@ip-172-31-25-114:~$ exit
logout
There are stopped jobs.
ubuntu@ip-172-31-25-114:~$ exit
logout
Connection to 34.235.165.167 closed.
(myenv) ivcpaladin@ivcpaladin:~/.ssh$
(myenv) ivcpaladin@ivcpaladin:~/.ssh$ aws ec2 terminate-instances --instance-ids i-03cfbcaca47b98126 --region us-east-1
{
    "TerminatingInstances": [
        {
            "InstanceId": "i-03cfbcaca47b98126",
            "CurrentState": {
                "Code": 32,
                "Name": "shutting-down"
            },
            "PreviousState": {
                "Code": 16,
                "Name": "running"
            }
        }
    ]
}
(myenv) ivcpaladin@ivcpaladin:~/.ssh$ aws ec2 describe-instances --instance-ids i-03cfbcaca47b98126 --region us-east-1
{
    "Reservations": [
        {
            "ReservationId": "r-002fbcc54ce40a40b",
            "OwnerId": "443370672158",
            "Groups": [],
            "Instances": [
                {
                    "Architecture": "x86_64",
                    "BlockDeviceMappings": [
                        {
                            "DeviceName": "/dev/sda1",
                            "Ebs": {
                                "AttachTime": "2025-01-05T08:36:41+00:00",
                                "DeleteOnTermination": true,
                                "Status": "attached",
                                "VolumeId": "vol-05f973ad985ad5661"
                            }
                        }
                    ],
                    "ClientToken": "02e281a46f4a4876a06a2df6ef8adef0",
                    "EbsOptimized": false,
                    "EnaSupport": true,
                    "Hypervisor": "xen",
                    "NetworkInterfaces": [
                        {
                            "Association": {
                                "IpOwnerId": "amazon",
                                "PublicDnsName": "ec2-34-235-165-167.compute-1.amazonaws.com",
                                "PublicIp": "34.235.165.167"
                            },
                            "Attachment": {
                                "AttachTime": "2025-01-05T08:36:40+00:00",
                                "AttachmentId": "eni-attach-099b9ebdf819dc28f",
                                "DeleteOnTermination": true,
                                "DeviceIndex": 0,
                                "Status": "attached",
                                "NetworkCardIndex": 0
                            },
(myenv) ivcpaladin@ivcpaladin:~/.ssh$




```
###
